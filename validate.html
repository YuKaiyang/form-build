<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
<script type="text/javascript" src="build/bundle.js"></script>
<div id="form"></div>
<script language="JavaScript">
	var city = ["北京", "上海"]
	var local = {
		"北京": ["东城", "西城"],
		"上海": ["静安", "浦东"]
	}
	function deepClone(obj) {
		var newObj = obj instanceof Array ? [] : {};
		for (var i in obj) {
			newObj[i] = typeof obj[i] === 'object' ?
				deepClone(obj[i]) : obj[i];
		}
		return newObj;
	}

	function onChange(param) {
		const schema = deepClone(param.schema)
		const uiSchema = deepClone(param.uiSchema)
		const formData = deepClone(param.formData)

		if (param.formData.city) {
			schema.properties.county.enum = local[param.formData.city]
			uiSchema.county = {}
		}
		else {
			uiSchema.county = {"ui:widget": "hidden"}
			formData.county = ""
		}
		window.myRender(schema, uiSchema, formData, "form", {
			validate,
			onChange,
			errorInfo,
			cascadeSchema,
			autoCompleteSchema
		})
	}

	function validate({pass1, pass2}, errors) {
		if (pass1 !== pass2) {
			errors.pass2.addError("两次输入密码不一致.");
		}
		return errors;
	}

	var errorInfo = {
		pass1: {name: "minLength", message: "密码至少有3位"},
		pass2: {name: "minLength", message: "密码至少有3位"},
		age: {name: "minimum", message: "年龄应该大于18岁"},
		email: {name: "pattern", message: "电子邮件不符合格式"}
	}

	var schema = {
		title: "客户验证",
		description: "该表单验证密码是否一致",
		type: "object",
		properties: {
			pass1: {
				title: "密码",
				type: "string",
				minLength: 3,
			},
			pass2: {
				title: "重复密码",
				type: "string",
				minLength: 3,
			},
			age: {
				title: "年龄",
				type: "number",
				placeholder: "请输入年龄",
				minimum: 18,
			},
			city: {
				"type": "string",
				"title": "城市",
				"enum": city,
				"id": "city"
			},
			county: {
				"type": "string",
				"title": "区县",
				"enum": [''],
				"id": "county"
			},
			city1: {
				"type": "string",
				"title": "城市(使用cascadeSchema)",
				"enum": city,
				"id": "city1"
			},
			county1: {
				"type": "string",
				"title": "区县(使用cascadeSchema)",
				"enum": [],
				"id": "county1"
			},
			email: {
				"type": "string",
				"title": "电子邮件",
				"id": "email",
				"pattern": "^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$",
			},
			myAutoComplete: {
				"type": "string",
				"title": "自动补全信息",
				"id": "myAutoComplete"
			},
			validate: {
				type: "object",
				properties: {
					func: {
						type: "function", default: function () {
							console.log("点击方法")
						}
					},
					time: {type: "number", default: 5000},
					value: {type: "string", default: "验证"},
					placeholder: {type: "string", default: "输入"},
					inputClass: {type: "string", default: ""},
					buttonClass: {type: "string", default: "btn btn-info"},
				},
			},
		},
	}
	var uiSchema = {
		pass1: {"ui:widget": "password"},
		pass2: {
			"ui:widget": "password",
			"ui:placeholder": "请再次输入密码"
		},
		county: {"ui:widget": "hidden"},
		validate: {"ui:field": "validate"},
	}
	var formData = {
		city1: "北京"
	}

	var cascadeSchema = {
		city1: [{name: 'county1', dataSource: local}]
	}
	/**
	 * @param id 自动补全的空间的id
	 * @param value //自动补全的输入框的输入值
	 * @returns 返回显示值数组
	 */
	function getAutoCompleteInfo(value) {
		console.log(value)
		return ["I1", "I2", "I3", "I4"]
	}

	var autoCompleteSchema = {
		myAutoComplete: {dataSource: getAutoCompleteInfo, inputClass: "", rowClass: ""}
	}

	window.myRender(schema, uiSchema, formData, "form", {
		validate,
		onChange,
		errorInfo,
		cascadeSchema,
		autoCompleteSchema,
	})
	//    window.myRender(schema, uiSchema, formData, "form", {validate,  errorInfo, cascadeSchema})
</script>
</body>
</html>